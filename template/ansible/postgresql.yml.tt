- hosts: 127.0.0.1
  connection: local
  vars_files:
    - vars/secure.yml
  vars:
    postgres_users_no_log: false
    # don't touch pg_hba.conf with empty list
    postgresql_hba_entries: {}
    postgresql_users:
      - name: <%= Rails.application.class.module_parent.to_s.underscore %>
        password: "{{ postgresql_user_password }}"
        encrypted: yes
    postgresql_databases:
      - name: <%= Rails.application.class.module_parent.to_s.underscore %>_development
        owner: <%= Rails.application.class.module_parent.to_s.underscore %>
        lc_collate: de_DE.UTF-8
        lc_ctype: de_DE.UTF-8

      - name: <%= Rails.application.class.module_parent.to_s.underscore %>_test
        owner: <%= Rails.application.class.module_parent.to_s.underscore %>
        lc_collate: de_DE.UTF-8
        lc_ctype: de_DE.UTF-8

  roles:
    - role: geerlingguy.postgresql
      become: yes
